<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç°¡ç´„ç›¤é»å«è²¨ç³»çµ±</title>

<script src="https://cdn.tailwindcss.com"></script>

<!-- Firebase CDNï¼ˆé moduleï¼Œé—œéµï¼‰ -->
<script src="https://www.gstatic.com/firebasejs/10.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.6.1/firebase-firestore-compat.js"></script>

<style>
body { background:#f4f7f6; }
.card { background:white; border-radius:12px; box-shadow:0 4px 6px rgba(0,0,0,.1); }
.hidden { display:none; }
</style>
</head>

<body class="p-4 md:p-8">
<div class="max-w-4xl mx-auto">

<h1 class="text-3xl font-bold text-center mb-6">ç›¤é»å«è²¨ç³»çµ±</h1>

<div class="flex justify-center mb-6 border-b">
<button id="tabInventory" onclick="switchTab('inventory')" class="px-6 py-3 border-b-4 border-blue-500 font-bold">ç›¤é»</button>
<button id="tabSettings" onclick="switchTab('settings')" class="px-6 py-3 text-slate-400">å“é …è¨­å®š</button>
</div>

<!-- ç›¤é» -->
<div id="pageInventory">
<div class="card p-6 mb-6">
<div class="flex justify-between mb-4">
<h2 class="font-bold">åº«å­˜ç›¤é»</h2>
<div>
<button onclick="setMode('weekday')" id="btnWeekday" class="px-4 py-1 bg-blue-500 text-white rounded">å¹³æ—¥</button>
<button onclick="setMode('saturday')" id="btnSaturday" class="px-4 py-1 bg-slate-200 rounded">é€±å…­</button>
</div>
</div>

<div id="inventoryContainer" class="grid md:grid-cols-2 gap-4"></div>
</div>

<div class="card p-6">
<h2 class="font-bold mb-2">å«è²¨æ¸…å–®</h2>
<pre id="summaryContent" class="bg-slate-100 p-3 rounded min-h-[80px]">å°šç„¡å«è²¨é …ç›®</pre>
<button onclick="copySummary()" class="w-full mt-3 bg-blue-600 text-white py-2 rounded">ä¸€éµè¤‡è£½</button>
</div>
</div>

<!-- è¨­å®š -->
<div id="pageSettings" class="hidden">
<div class="card p-6">
<table class="w-full">
<thead>
<tr class="border-b">
<th>å“é …</th><th>å¹³æ—¥</th><th>é€±å…­</th><th>é€²ä½</th><th>å–®ä½</th><th></th>
</tr>
</thead>
<tbody id="settingList"></tbody>
</table>

<button onclick="addItem()" class="mt-4 bg-slate-800 text-white px-4 py-2 rounded">
ï¼‹ æ–°å¢å“é …
</button>
</div>
</div>

</div>

<script>
// ğŸ”¥ Firebase åˆå§‹åŒ–
firebase.initializeApp({
 apiKey: "AIzaSyCiWs5ZtstLxSSLQHufvnrWilnnGADFbEI",
 authDomain: "ngdd-8dd14.firebaseapp.com",
 projectId: "ngdd-8dd14"
});
const db = firebase.firestore();

// ===== è³‡æ–™ =====
let items = [];
let currentMode = 'weekday';
const currentStocks = {};
const needs = {};

// ===== Firebase å³æ™‚åŒæ­¥ =====
db.collection('items').onSnapshot(snap=>{
 items = snap.docs.map(d=>({id:d.id,...d.data()}));
 renderSettings();
 renderInventory();
});

// ===== åŠŸèƒ½ =====
function switchTab(tab){
 document.getElementById('pageInventory').classList.toggle('hidden',tab!=='inventory');
 document.getElementById('pageSettings').classList.toggle('hidden',tab!=='settings');
}

function setMode(mode){
 currentMode = mode;
 renderInventory();
}

function addItem(){
 const id = Date.now().toString();
 const item = { name:'', weekday:0, saturday:0, unit:'', round:false, currentStock:0 };
 db.collection('items').doc(id).set(item);
}

function deleteItem(id){
 db.collection('items').doc(id).delete();
}

function updateItemData(id, field, value){
 if(field==='weekday'||field==='saturday'||field==='currentStock'){
   value = parseFloat(value)||0;
 }
 db.collection('items').doc(id).update({[field]:value});
}

// ===== Render =====
function renderSettings(){
 const el=document.getElementById('settingList');
 el.innerHTML='';
 items.forEach(i=>{
 el.innerHTML+=`
<tr class="border-b">
<td><input value="${i.name}" oninput="updateItemData('${i.id}','name',this.value)"></td>
<td><input type="number" value="${i.weekday}" oninput="updateItemData('${i.id}','weekday',this.value)"></td>
<td><input type="number" value="${i.saturday}" oninput="updateItemData('${i.id}','saturday',this.value)"></td>
<td><input type="checkbox" ${i.round?'checked':''} onchange="updateItemData('${i.id}','round',this.checked)"></td>
<td><input value="${i.unit}" oninput="updateItemData('${i.id}','unit',this.value)"></td>
<td><button onclick="deleteItem('${i.id}')" class="text-red-500">âœ•</button></td>
</tr>`;
 });
}

function renderInventory(){
 const el=document.getElementById('inventoryContainer');
 el.innerHTML='';
 needsClear();
 items.forEach(i=>{
 if(!i.name) return;
 const target = currentMode==='weekday'?i.weekday:i.saturday;
 const stock = i.currentStock||0;
 const need = Math.max(0,target-stock);
 if(need>0) needs[i.id]=`${i.name}: ${need} ${i.unit}`;
 el.innerHTML+=`
<div class="p-4 bg-slate-100 rounded">
<b>${i.name}</b><br>
<input type="number" value="${stock}" oninput="updateItemData('${i.id}','currentStock',this.value)">
<div class="text-blue-600 font-bold">éœ€è£œ ${need} ${i.unit}</div>
</div>`;
 });
 updateSummary();
}

function needsClear(){ for(let k in needs) delete needs[k]; }

function updateSummary(){
 const box=document.getElementById('summaryContent');
 const list=Object.values(needs);
 box.textContent=list.length?list.join('\n'):'å°šç„¡å«è²¨é …ç›®';
}

function copySummary(){
 navigator.clipboard.writeText(document.getElementById('summaryContent').textContent);
 alert('å·²è¤‡è£½');
}

// ===== æ›åˆ° windowï¼ˆé—œéµï¼‰=====
window.switchTab = switchTab;
window.setMode = setMode;
window.addItem = addItem;
window.deleteItem = deleteItem;
window.updateItemData = updateItemData;
window.copySummary = copySummary;
</script>

</body>
</html>
